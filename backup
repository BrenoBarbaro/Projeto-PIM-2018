#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <conio.h>
#include <windows.h>

void gotoxy(int x, int y){
     SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE),(COORD){x-1,y-1});
}

typedef struct Produtos
{
	char codProduto[5];
	char nomeProduto[12];
	double valorProduto;
	int quantidade;
	struct Produtos *proximo;
} Produtos;

typedef struct Venda
{
	int codVenda;
	double totalCompra;
    struct Venda *proximo;
} Venda;

typedef struct notaCliente
{
	double total;
	double troco;
}notaCliente;

notaCliente *comprovante = NULL;

typedef struct Login
{
	char nomeUsuario[30];
    char dataNascimento[11];
    char telefone[12];
    char email[30];
	char usuarioCadastrado[12];
	char senhaCadastrada[8];
	struct Login *proximo;
}Login;

Produtos *inicio = NULL;
Produtos *carrinhoCliente = NULL;
Produtos *itemVendaInicio = NULL;
Login *ListaUsers = NULL;

double totalGlobal=0;
double trocoGlobal=0;
double somaValor=0;

void menu();
void DesingCaixa();
void ExibeProdutos();
void iniciaCompra();
void notaVendaCliente();
void notaVendaDebito();
void notaVendaCredito();
void administrativeSystem();
void saldoDia();
void produtosVendidos();
void adicionarProdutos();
void ExibeProdutosAdmin();
void menuFuncionario();
void cadastraUsuario();
void MostraLogin();
void telaLogin();
void autorizaLogin();
void autorizaCaixa();
void autorizaAdministrativo();
void autorizaSeguranca();
void PesquisaFuncionario();
void listarFuncionarios();
void lerParaStruct();
void gravarArquivo();
void sair();
void retornar();

int main()
{

	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		cadastraUsuario();
	}else{
		telaLogin();
	}
	fclose(fp);

	return 0;
}

// ----------------------- Menu -----------------------

void menu()
{
	char c;

	do{
	    system("cls");
	    printf("**********************************************************");
	    printf("\n*                    NewHorizon Market                   *");
	    printf("\n*                                                        *");
	    printf("\n*      1 - Sistema de Caixa                              *");
	    printf("\n*      2 - Sistema Administrativo                        *");
	    printf("\n*      3 - Sistema de Seguranca                          *");
	    printf("\n*                                                        *");
	    printf("\n*      5 - Sair                                          *");
	    printf("\n*                                                        *");
	    printf("\n**********************************************************");
	    printf("\n*      Opcao:                                            *");
	    printf("\n**********************************************************");
	    gotoxy(15,11); c = getch();
	    switch(c)
		{
			case '1': autorizaCaixa(); break;

			case '2': autorizaAdministrativo(); break;

			case '3': autorizaSeguranca(); break;

			case '5': sair(); break;

			default: gotoxy(15,11); printf("Opcao Invalida.  (Press enter to continue)"); break;
		}
		gotoxy(1,13); getch();
	}while(c != '5');
}

// --------------------- Menu Caixa --------------------

void DesingCaixa()
{
    char op1;
    system("cls");
    printf("******************************************************");
    printf("\n*                Sistema de Mercado                  *");
    printf("\n*                                                    *");
    printf("\n*      1 - Iniciar Compras                           *");
    printf("\n*                                                    *");
    printf("\n*                                                    *");
    printf("\n*      5 - Sair                                      *");
    printf("\n*                                                    *");
    printf("\n******************************************************");
    printf("\n*      Opcao:                                        *");
    printf("\n******************************************************\n");
    op1 = getch();
    switch(op1)
    {
        case '1': iniciaCompra(); break;

        case '5': retornar(); break;

        default: printf("\n\nTecla invalida!\n"); break;
    }
}

void ExibeProdutos()
{
    Produtos *aux = inicio;
    Produtos *cCliente = itemVendaInicio;
	int y=5;

	if(aux == NULL)
	{
		printf("Nao ha produtos cadastrados.");
		printf("\t(Press enter to continue)");
	}else{
		system("CLS");
	    printf("***************************************************************************\n");
	    printf("                                                                           \n");
	    printf("    Codigo:        Nome:                Quantidade:           Valor(Kg):   \n");
	    printf("                                                                           \n");
	    while(aux!=NULL)
		{
			gotoxy(5,y);printf("%s",aux->codProduto);
			gotoxy(20,y);printf("%s",aux->nomeProduto);
			gotoxy(41,y);printf("%d",aux->quantidade);
			gotoxy(63,y);printf("%0.2lf",aux->valorProduto);
			y++;
			aux = aux->proximo;
		}
	    printf("                                                                           \n");
	    printf("\n***************************************************************************\n\n");
	}
}

void iniciaCompra()
{
	fflush(stdin);
	Produtos *aux = inicio;	
	Produtos *NovoItem = (Produtos*) malloc(sizeof(Produtos));
	NovoItem->proximo = NULL;
	char c;
	char formaPag;
	char cartaoDebito[20];
	char cartaoCredito[20];
	int senhaDebito = 0;
	int senhaCredito = 0;
	int tamanho;
	double troco;
	double saldoDebito = 0;
	double saldoCredio = 0;
	double saldoCaixa = 800;
	double resultValor = 0;
	double valorCliente = 0;
	double valorTotal = 0;
	
	
	if(aux == NULL)
	{
		printf("Nao ha produtos cadastrados.");
		menu();
	}
		system("CLS");
		ExibeProdutos();

		char codigo[5];
		int qtd;
		for(int x=0;x<5;x++)
		{
			codigo[x] = ' ';
		}
		
		fflush(stdin);
		printf("Codigo: ");
		fflush(stdin);
		gets(codigo);
		fflush(stdin);
		codigo[strcspn(codigo,"\r\n")] = '\0';
		fflush(stdin);
		while(aux!=NULL)
		{
			if(strcmp(codigo,aux->codProduto)==0)
			{
 				strcpy(NovoItem->codProduto,aux->codProduto);
 				strcpy(NovoItem->nomeProduto,aux->nomeProduto);
 				QTD:
				printf("Quantidade: ");
				scanf("%d",&qtd);
				if(qtd<=0)
				{
					printf("\tIntroduza uma quantidade superior a 0.\n");
					goto QTD;
				}else if(qtd>aux->quantidade){
					printf("\tQuantidade limite em estoque: %d\n\t",aux->quantidade);
					goto QTD;
				}
				NovoItem->quantidade = qtd;
				aux->quantidade -= qtd;
				NovoItem->valorProduto = aux->valorProduto;
				resultValor = aux->valorProduto * qtd;
				valorTotal += resultValor;
				Produtos *auxItem = itemVendaInicio;
				if(itemVendaInicio == NULL)
				{
					itemVendaInicio = NovoItem;
				}else{
					while(auxItem->proximo != NULL)
					{
						auxItem = auxItem->proximo;
					}
					auxItem->proximo = NovoItem;
				}
			}
			aux = aux->proximo;
		}
		printf("\n\nAdicionar mais produtos?  <SIM> --> (s / n) <-- <NAO>)");
		c =	getch();
		if((c == 's') || (c == 'S'))
		{
			somaValor += NovoItem->valorProduto;
			iniciaCompra();
		}
		else if((c == 'n') || (c== 'N'))
		{
			Venda *novaVenda = (Venda*)malloc(sizeof(Venda));
			novaVenda->proximo = NULL;
			int xy=9;
			novaVenda->totalCompra = valorTotal;
			Produtos *cCliente = itemVendaInicio;
			system("CLS");
			printf("***************************************************************************\n");
			printf("                                 Carrinho                                \n");
			printf("                                                                         \n");
			printf("     TOTAL:  R$                                                            \n");
			printf("                                                                         \n");
			printf("***************************************************************************\n");
			printf("    Codigo:        Nome:                Quantidade:           Valor(Kg):   \n");
			gotoxy(17,4); printf("%0.2lf",novaVenda->totalCompra);
			while(cCliente!=NULL)
			{
					gotoxy(5,xy);printf("%s",cCliente->codProduto);
					gotoxy(20,xy);printf("%s",cCliente->nomeProduto);
					gotoxy(41,xy);printf("%d",cCliente->quantidade);
					gotoxy(63,xy);printf("%0.2lf",cCliente->valorProduto);
					cCliente = cCliente->proximo;
					xy++;
			}
			printf("\n\n*                                                                         *\n");
			printf("***************************************************************************\n\n");
			
			FormPag:
			printf("\n\nForma de pagamento?\n");
			printf("1 - Dinheiro\n");
			printf("2 - Cartao\n\n");
			formaPag = getch();
			switch(formaPag)
			{
				case '1':
						Dinheiro:
						printf("Introduza o valor: R$ ");
						valCliente:
						scanf("%lf",&valorCliente);
						if(valorCliente < novaVenda->totalCompra)
						{
							printf("\n\nValor da compra: R$ %0.2lf\n",novaVenda->totalCompra);
							printf("Valor introduzido pelo cliente: R$ %0.2lf",valorCliente);
							printf("\n\nIntroduza o valor novamente: ");
							goto valCliente;
						}
						troco = valorCliente - novaVenda->totalCompra;
						saldoCaixa -= troco;
						printf("\n\nTroco: R$ %0.2lf",troco);
						printf("\nSaldo em caixa: R$ %0.2lf",saldoCaixa);
					    printf("\n\n(Press Enter to continue)");
					    trocoGlobal = troco;
					    totalGlobal = novaVenda->totalCompra;
						getch();
						notaVendaCliente();
				break;
				case '2':
						printf("3 -> Cartao de Debito\n");
						printf("4 -> Cartao de Credito\n");
						DebOuCred:
						c = getch();
						switch(c)
						{
							case '3': 
									cardDebito:
									printf("\nIMPORTANTE: Digite o numero do cartao contendo 16 digitos \nseparados por espaco. Ex: 0000 0000 0000 0000");
									printf("\n\nDigite o numero do cartao: ");
									Card:
									fflush(stdin);
									fgets(cartaoDebito,sizeof(cartaoDebito),stdin);
									fflush(stdin);
									cartaoDebito[strcspn(cartaoDebito,"\r\n")] = '\0';
									tamanho = strlen(cartaoDebito);
									if(tamanho>19)
									{
										printf("\nCartao digitado com mais de 16 digitos.");
										printf("\nDigite o numero do cartao novamente: ");
										goto Card;
									}else if(tamanho<19){
										printf("\nCartao digitado com menos de 16 digitos.");
										printf("\nDigite o numero do cartao novamente: ");
										goto Card;
									}else{
										fflush(stdin);
										printf("Digite a senha(SOMENTE DIGITOS): ");
										scanf("%d",&senhaDebito);
										printf("\nPagamento efetuado");
										printf("\n\n(Press enter to continue)");
										getch();
										notaVendaDebito();
									}
							break;
						
							case '4':
									cardCredito:
									printf("\nIMPORTANTE: Digite o numero do cartao contendo 16 digitos \nseparados por espaco. Ex: 0000 0000 0000 0000");
									printf("\n\nDigite o numero do cartao: ");
									fflush(stdin);
									fgets(cartaoCredito,sizeof(cartaoCredito),stdin);
									fflush(stdin);
									cartaoCredito[strcspn(cartaoCredito,"\r\n")] = '\0';
									tamanho = strlen(cartaoCredito);
									if(tamanho>19)
									{
										printf("\nCartao digitado com mais de 16 digitos.");
										printf("\nDigite o numero do cartao novamente: ");
										goto cardCredito;
									}else if(tamanho<19){
										printf("\nCartao digitado com menos de 16 digitos.");
										printf("\nDigite o numero do cartao novamente: ");
										goto cardCredito;
									}else{
										printf("Digite a senha(SOMENTE DIGITOS): ");
										scanf("%d",&senhaCredito);
										printf("\nPagamento efetuado");
										printf("\n\n(Press enter to continue)");
										getch();
										notaVendaCredito();
									}
							break;
							
							default: printf("\n\nOpcao Invalida.   Tente novamente."); goto DebOuCred; break;
						}
				break;
				
				default: printf("\n\nOpcao Invalida.   Tente novamente."); goto FormPag; break;
			}
		}
}

void notaVendaCliente()
{
	Produtos *cCliente = itemVendaInicio;
	int y = 11;
	system("CLS");
	printf("***************************************************************************\n");
	printf("*                                                                         *\n");
	printf("*                             NewHorizon Market                           *\n");
	printf("*                                                                         *\n");
	printf("*                                                                         *\n");
	printf("*                           COMPROVANTE DE COMPRA                         *\n");
	printf("*                                                                         *\n");
	printf("***************************************************************************\n");
	printf("    Codigo:        Nome:                Quantidade:           Valor(Kg):   \n");
	while(cCliente!=NULL)
	{
		gotoxy(5,y);printf("%s",cCliente->codProduto);
		gotoxy(20,y);printf("%s",cCliente->nomeProduto);
		gotoxy(41,y);printf("%d",cCliente->quantidade);
		gotoxy(63,y);printf("%0.2lf",cCliente->valorProduto);
		cCliente = cCliente->proximo;
		y++;
	}
	printf("\n\n*                                                                         *\n");
	printf("***************************************************************************\n");
	printf("*                                                                         *\n");
	printf("*     Forma de Pagamento: Dinheiro                 TOTAL: R$              *\n");
	printf("*                                                  TROCO: R$              *\n");
	printf("*                                                                         *\n");
	printf("***************************************************************************\n\n");
	printf("           *************************************************");
	printf("\n          *                                               *");
	printf("\n          *     Obrigado , NewHorizon Market agradece     *");
	printf("\n          *         sua presenca, volte sempre.           *");
	printf("\n          *                                               *");
	printf("\n          *************************************************\n");
	for(int x=0;x<=3;x++)
	{
		y++;
	}
	gotoxy(63,y); printf("%0.2lf",totalGlobal); y++;
	gotoxy(63,y); printf("%0.2lf",trocoGlobal);
}

void notaVendaDebito()
{
	Produtos *cCliente = itemVendaInicio;
	int y = 11;
	system("CLS");
	printf("***************************************************************************\n");
	printf("*                                                                         *\n");
	printf("*                             NewHorizon Market                           *\n");
	printf("*                                                                         *\n");
	printf("*                                                                         *\n");
	printf("*                           COMPROVANTE DE COMPRA                         *\n");
	printf("*                                                                         *\n");
	printf("***************************************************************************\n");
	printf("    Codigo:        Nome:                Quantidade:           Valor(Kg):   \n");
	while(cCliente!=NULL)
	{
		gotoxy(5,y);printf("%s",cCliente->codProduto);
		gotoxy(20,y);printf("%s",cCliente->nomeProduto);
		gotoxy(41,y);printf("%d",cCliente->quantidade);
		gotoxy(63,y);printf("%0.2lf",cCliente->valorProduto);
		cCliente = cCliente->proximo;
		y++;
	}
	printf("\n\n*                                                                         *\n");
	printf("***************************************************************************\n");
	printf("*                                                                         *\n");
	printf("*     Forma de Pagamento: Debito                   TOTAL: R$              *\n");
	printf("*                                                                         *\n");
	printf("*                                                                         *\n");
	printf("***************************************************************************\n\n");
	printf("           *************************************************");
	printf("\n          *                                               *");
	printf("\n          *     Obrigado , NewHorizon Market agradece     *");
	printf("\n          *         sua presenca, volte sempre.           *");
	printf("\n          *                                               *");
	printf("\n          *************************************************\n");
	for(int x=0;x<=3;x++)
	{
		y++;
	}
	gotoxy(63,y); printf("%0.2lf",totalGlobal); y++;
}

void notaVendaCredito()
{
	Produtos *cCliente = itemVendaInicio;
	int y = 11;
	system("CLS");
	printf("***************************************************************************\n");
	printf("*                                                                         *\n");
	printf("*                             NewHorizon Market                           *\n");
	printf("*                                                                         *\n");
	printf("*                                                                         *\n");
	printf("*                           COMPROVANTE DE COMPRA                         *\n");
	printf("*                                                                         *\n");
	printf("***************************************************************************\n");
	printf("    Codigo:        Nome:                Quantidade:           Valor(Kg):   \n");
	while(cCliente!=NULL)
	{
		gotoxy(5,y);printf("%s",cCliente->codProduto);
		gotoxy(20,y);printf("%s",cCliente->nomeProduto);
		gotoxy(41,y);printf("%d",cCliente->quantidade);
		gotoxy(63,y);printf("%0.2lf",cCliente->valorProduto);
		cCliente = cCliente->proximo;
		y++;
	}
	printf("\n\n*                                                                         *\n");
	printf("***************************************************************************\n");
	printf("*                                                                         *\n");
	printf("*     Forma de Pagamento: Credito                  TOTAL: R$              *\n");
	printf("*                                                                         *\n");
	printf("*                                                                         *\n");
	printf("***************************************************************************\n\n");
	printf("           *************************************************");
	printf("\n          *                                               *");
	printf("\n          *     Obrigado , NewHorizon Market agradece     *");
	printf("\n          *         sua presenca, volte sempre.           *");
	printf("\n          *                                               *");
	printf("\n          *************************************************\n");
	for(int x=0;x<=3;x++)
	{
		y++;
	}
	gotoxy(63,y); printf("%0.2lf",totalGlobal); y++;
}

// ----------------- Menu Administrativo -----------------

void administrativeSystem()
{
    char op2;
    do{
	    system("CLS");
	    printf("**********************************************************");
	    printf("\n*               Sistema de Administrativo                *");
	    printf("\n*                                                        *");
	    printf("\n*   1 - Saldo de Vendas do Dia                           *");
	    printf("\n*   2 - Adicionar Produtos                               *");
	    printf("\n*   3 - Exibir Produtos                                  *");
	    printf("\n*   4 - Iniciar Produtos                                 *");
	    printf("\n*   5 - Gravar Produtos                                  *");
	    printf("\n*                                                        *");
	    printf("\n*                                                        *");
		printf("\n*                                                        *");
	    printf("\n*   9 - Sair                                             *");
	    printf("\n*                                                        *");
	    printf("\n**********************************************************");
	    printf("\n*   Opcao:                                               *");
	    printf("\n**********************************************************");
	    gotoxy(12,15); op2 = getch();
	    switch(op2)
	    {
	        case '1': saldoDia(); break;

	        case '2': adicionarProdutos();    break;

	        case '3': ExibeProdutosAdmin();  getch(); break;

	        case '4': lerParaStruct();	break;

	        case '5': gravarArquivo();	break;

	        case '9': retornar(); break;

	        default: printf("\n\nOpcao invalida.  (Press enter to continue)"); getch(); break;
	    }
	}while(op2 != '5');
}

void saldoDia()
{
    system("CLS");
    printf("*********************************************************************");
    printf("\n*                        Saldos do Dia                              *");
    printf("\n*                                                                   *");
    printf("\n*   N. Venda:        Quantidade de Produtos:        Valor:          *");
    printf("\n*                                                                   *");
    printf("\n*        1                    85                    R$ 458.78       *");
    printf("\n*        2                     7                    R$ 15.82        *");
    printf("\n*        3                    15                    R$ 31.02        *");
    printf("\n*        4                     5                    R$ 10.98        *");
    printf("\n*        5                    19                    R$ 19.19        *");
    printf("\n*        6                    45                    R$ 65.75        *");
    printf("\n*        7                   126                    R$ 726.15       *");
    printf("\n*        8                    72                    R$ 389.17       *");
    printf("\n*        9                    23                    R$ 25.12        *");
    printf("\n*        10                   31                    R$ 43.68        *");
    printf("\n*        11                   14                    R$ 20.98        *");
    printf("\n*                                                                   *");
    printf("\n*********************************************************************\n");
    system("PAUSE");
}

void adicionarProdutos()
{
    Produtos *novo = (Produtos*)malloc(sizeof(Produtos));
    novo->proximo = NULL;
	
	system("CLS");
	printf("*********************************************************************");
	printf("\n*                                                                   *");
	printf("\n*                       Adicionar Produtos                          *");
	printf("\n*                                                                   *");
	printf("\n*                                                                   *");
	printf("\n*     Codigo do Produto:                                            *");
	printf("\n*                                                                   *");
	printf("\n*     Nome do Produto:                                              *");
	printf("\n*                                                                   *");
	printf("\n*     Valor do produto(Kg):                                         *");
	printf("\n*                                                                   *");
	printf("\n*     Quantidade:                                                   *");
	printf("\n*                                                                   *");
	printf("\n*                                                                   *");
	printf("\n*                                                                   *");
	printf("\n*                                                                   *");
	printf("\n*********************************************************************\n");
	fflush(stdin);
	gotoxy(26,6);gets(novo->codProduto);
	fflush(stdin);
	gotoxy(24,8);gets(novo->nomeProduto);
	gotoxy(30,10);printf("R$");
	fflush(stdin);
	gotoxy(33,10);scanf("%lf",&novo->valorProduto);
	fflush(stdin);
	gotoxy(19,12);scanf("%d",&novo->quantidade);
	fflush(stdin);
	
	if(inicio == NULL){
            inicio = novo;
	}else{
		Produtos *pAux = inicio;
        while(pAux->proximo != NULL){
        	pAux = pAux->proximo;	
		}
		pAux->proximo = novo;
	}
	gotoxy(7,15);printf("Produto adicionado com sucesso!");
	gotoxy(1,19);printf("(Press enter to continue)");
	
	getch();
}

void ExibeProdutosAdmin()
{
	Produtos *aux = inicio;
	int y=5;

	if(aux==NULL)
	{
		printf("Nao ha produtos cadastrados.");
	}
    system("CLS");
	printf("***********************************************************************\n");
    printf("                                                                       \n");
	printf("    Codigo:        Nome:                Quantidade:           Valor:   \n");
	printf("                                                                       \n");
	while(aux!=NULL)
	{		
		char cod[5];
		char nom[15];
		int qq;
		double val;
		strcpy(cod,aux->codProduto);
		strcpy(nom,aux->nomeProduto);
		qq = aux->quantidade;
		val = aux->valorProduto;
		gotoxy(5,y);printf("%s",cod);
		gotoxy(20,y);printf("%s",nom);
		gotoxy(41,y);printf("%d",qq);
		gotoxy(63,y);printf("%0.2lf",val);
		y++;
		aux=aux->proximo;
	}
    printf("                                                                       \n");
    printf("\n***********************************************************************\n\n");
    printf("(Press enter to continue)");
}

// ------------------- Funcionarios -------------------

void menuFuncionario()
{

    char op;

    do
    {
        fflush(stdin);
        system("cls");
        printf("******************************************************");
        printf("\n*                 NewHorizon Market                  *");
        printf("\n*                                                    *");
        printf("\n*      1 - Cadastrar Funcionario                     *");
        printf("\n*      2 - Listar Funcionarios                       *");
        printf("\n*      3 - Pesquisar Funcionario                     *");
        printf("\n*                                                    *");
        printf("\n*                                                    *");
        printf("\n*      5 - Sair                                      *");
        printf("\n*                                                    *");
        printf("\n******************************************************");
        printf("\n*      Opcao:                                        *");
        printf("\n******************************************************");
        gotoxy(15,12); op = getch();
        switch(op)
        {

            case '1': cadastraUsuario(); break;

            case '2': autorizaLogin();

            case '3': PesquisaFuncionario(); break;

  	    	case '5': retornar(); break;

            default: gotoxy(15,10); printf("Opcao Invalida\n\nPressione Enter para continuar!"); break;
        }
    }while(op != 5);
}

void cadastraUsuario()
{
	Login cUsers;

	FILE *fp;

	if((fp = fopen("Usuarios.dat","ab"))==NULL)
	{
		printf("Problema na abertura do arquivo.\n\n");
		exit(1);
	}
	system("CLS");
	printf("****************************************************\n");
	printf("               Cadastro de usuarios                 \n");
	printf("                                                    \n");
	printf("      Nome:                                         \n");
	printf("                                                    \n");
	printf("      Dat. Nasc.:                                   \n");
	printf("                                                    \n");
	printf("      telefone:                                     \n");
	printf("                                                    \n");
	printf("      E-mail:                                       \n");
	printf("                                                    \n");
	printf("      Usuario:                                      \n");
	printf("                                                    \n");
	printf("      Senha:                                        \n");
	printf("                                                    \n");
	printf("                                                    \n");
	printf("                                                    \n");
	printf("****************************************************\n");
	fflush(stdin);
	gotoxy(13,4);gets(cUsers.nomeUsuario);
	fflush(stdin);
	gotoxy(19,6);gets(cUsers.dataNascimento);
	fflush(stdin);
	gotoxy(17,8);gets(cUsers.telefone);
	fflush(stdin);
	gotoxy(15,10);gets(cUsers.email);
	fflush(stdin);
	gotoxy(16,12);gets(cUsers.usuarioCadastrado);
	fflush(stdin);
	gotoxy(14,14);gets(cUsers.senhaCadastrada);
	fflush(stdin);
	gotoxy(7,16);printf("Usuario cadastrado com sucesso!");
	fflush(stdout);
	gotoxy(1,20);printf("(Press enter to continue)");

	fwrite(&cUsers,sizeof(Login),1,fp);
	fclose(fp);
	menu();

}

void MostraLogin()
{
	Login cUsers;
	char usuario[12];
    char senha[8];
    int i=0,x=3;

	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		printf("Problema na abertura do arquivo.\n\n");
	}
	printf("\n\n");
	while(fread(&cUsers,sizeof(Login),1,fp)==1)
	{
	}
    fclose(fp);
    do
	{
		system("CLS");
		printf("******************************************************\n");
		printf("                       Login                          \n");
		printf("                                                      \n");
		printf("      Usuario:                                        \n");
		printf("      Senha:                                          \n");
		printf("                                                      \n");
		printf("******************************************************\n");
		fflush(stdin);
		gotoxy(16,4); gets(usuario);
		fflush(stdin);
		gotoxy(14,5); gets(senha);
		fflush(stdin);

		usuario[strcspn(usuario,"\r\n")] = '\0';
		senha[strcspn(senha,"\r\n")] = '\0';

		if((strcmp(cUsers.usuarioCadastrado,usuario)==0) && (strcmp(cUsers.senhaCadastrada,senha)==0))
		{
			menu();
		}else{
			printf("\n\nUsuario ou Senha Invalido!\n\n");
		}
		printf("Restam %d tentativas\t\tPressione qualquer tecla para continuar!",x--);
		getch();
		i++;
	}while(i<=3);
	exit(1);
}

void telaLogin()
{
	Login cUsers;
	char usuario[12];
    char senha[8];

	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		printf("Problema na abertura do arquivo.\n\n");
	}
	printf("\n\n");
	while(fread(&cUsers,sizeof(Login),1,fp)==1)
	{

	}
    fclose(fp);
    system("CLS");
	printf("******************************************************\n");
	printf("                       Login                          \n");
	printf("                                                      \n");
	printf("      Usuario:                                        \n");
	printf("      Senha:                                          \n");
	printf("                                                      \n");
	printf("******************************************************\n");
	fflush(stdin);
	gotoxy(16,4); gets(usuario);
	fflush(stdin);
	gotoxy(14,5); gets(senha);
	fflush(stdin);

	usuario[strcspn(usuario,"\r\n")] = '\0';
	senha[strcspn(senha,"\r\n")] = '\0';

	if((strcmp(cUsers.usuarioCadastrado,usuario)==0) && (strcmp(cUsers.usuarioCadastrado,usuario)==0))
	{
		menu();
	}else{
		printf("\n\nUsuario ou Senha Invalido!\n\n");
	}
	getch();
	exit(1);
}

void autorizaLogin()
{
	Login cUsers;
	char usuario[12];
    char senha[8];

	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		printf("Problema na abertura do arquivo.\n\n");
	}
	printf("\n\n");
	while(fread(&cUsers,sizeof(Login),1,fp)==1)
	{

	}
    fclose(fp);

	printf("********************************************************\n");
	printf("                       Login                            \n");
	printf("                                                        \n");
	printf("      Usuario:                                          \n");
	printf("      Senha:                                            \n");
	printf("                                                        \n");
	printf("********************************************************\n");
	fflush(stdin);
	gotoxy(16,17); gets(usuario);
	fflush(stdin);
	gotoxy(14,18); gets(senha);
	fflush(stdin);

	usuario[strcspn(usuario,"\r\n")] = '\0';
	senha[strcspn(senha,"\r\n")] = '\0';

	if((strcmp(cUsers.usuarioCadastrado,usuario)==0) && (strcmp(cUsers.usuarioCadastrado,usuario)==0))
	{
		listarFuncionarios();
	}else{
		menu();
	}
	getch();
}

void autorizaCaixa()
{
	Login cUsers;
	char usuario[12];
    char senha[8];

	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		printf("Problema na abertura do arquivo.\n\n");
	}
	printf("\n\n");
	while(fread(&cUsers,sizeof(Login),1,fp)==1)
	{

	}
    fclose(fp);

    system("CLS");
	printf("********************************************************\n");
	printf("                       Login                            \n");
	printf("                                                        \n");
	printf("      Usuario:                                          \n");
	printf("      Senha:                                            \n");
	printf("                                                        \n");
	printf("********************************************************\n");
	fflush(stdin);
	gotoxy(16,4); gets(usuario);
	fflush(stdin);
	gotoxy(14,5); gets(senha);
	fflush(stdin);

	usuario[strcspn(usuario,"\r\n")] = '\0';
	senha[strcspn(senha,"\r\n")] = '\0';

	if((strcmp(cUsers.usuarioCadastrado,usuario)==0) && (strcmp(cUsers.usuarioCadastrado,usuario)==0))
	{
		DesingCaixa();
	}else{
		menu();
	}
	getch();
}

void autorizaAdministrativo()
{
	Login cUsers;
	char usuario[12];
    char senha[8];

	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		printf("Problema na abertura do arquivo.\n\n");
	}
	printf("\n\n");
	while(fread(&cUsers,sizeof(Login),1,fp)==1)
	{

	}
    fclose(fp);

	system("CLS");
	printf("******************************************************\n");
	printf("                       Login                          \n");
	printf("                                                      \n");
	printf("      Usuario:                                        \n");
	printf("      Senha:                                          \n");
	printf("                                                      \n");
	printf("******************************************************\n");
	fflush(stdin);
	gotoxy(16,4); gets(usuario);
	fflush(stdin);
	gotoxy(14,5); gets(senha);
	fflush(stdin);

	usuario[strcspn(usuario,"\r\n")] = '\0';
	senha[strcspn(senha,"\r\n")] = '\0';

	if((strcmp(cUsers.usuarioCadastrado,usuario)==0) && (strcmp(cUsers.usuarioCadastrado,usuario)==0))
	{
		administrativeSystem();
	}else{
		menu();
	}
	getch();
}

void autorizaSeguranca()
{
	Login cUsers;
	char usuario[12];
    char senha[8];

	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		printf("Problema na abertura do arquivo.\n\n");
	}
	printf("\n\n");
	while(fread(&cUsers,sizeof(Login),1,fp)==1)
	{

	}
    fclose(fp);

	system("CLS");
	printf("****************************************************\n");
	printf("                       Login                        \n");
	printf("                                                    \n");
	printf("      Usuario:                                      \n");
	printf("      Senha:                                        \n");
	printf("                                                    \n");
	printf("****************************************************\n");
	fflush(stdin);
	gotoxy(16,4); gets(usuario);
	fflush(stdin);
	gotoxy(14,5); gets(senha);
	fflush(stdin);

	usuario[strcspn(usuario,"\r\n")] = '\0';
	senha[strcspn(senha,"\r\n")] = '\0';

	if((strcmp(cUsers.usuarioCadastrado,usuario)==0) && (strcmp(cUsers.usuarioCadastrado,usuario)==0))
	{
		menuFuncionario();
	}else{
		menu();
	}
	getch();
}

void PesquisaFuncionario()
{
	Login cUsers;
	char usuario[12];

	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		printf("Problema na abertura do arquivo!\n");
	}else{
		system("CLS");
		printf("---> Pesquisa Funcionario <---\n\n");
		fflush(stdin);
		printf("Usuario: ");
		gets(usuario);
		printf("\n\n");
		while(fread(&cUsers,sizeof(Login),1,fp)==1)
		{
			if(strcmp(cUsers.usuarioCadastrado,usuario)==0)
			{
				printf("---------------------------------\n");
				printf("Usuario: %s existente",cUsers.usuarioCadastrado);
				printf("\n---------------------------------\n\n");
			}else{
				printf("---------------------------------\n");
				printf("Usuario: %s inexistente",usuario);
				printf("\n---------------------------------\n\n");
			}
		}
	}
	getch();
}

void listarFuncionarios()
{
	Login cUsers;
	FILE *fp;

	if((fp = fopen("Usuarios.dat","rb"))==NULL)
	{
		printf("Problema na abertura do arquivo!\n");
	}else{
		printf("\n\n");
		while(fread(&cUsers,sizeof(Login),1,fp)==1)
		{
			printf("******************************************************\n");
			printf("                                                      \n");
		   	printf("                 Usuario: %s                          \n",cUsers.usuarioCadastrado);
			printf("                                                      \n");
			printf("      Nome: %s                                        \n",cUsers.nomeUsuario);
			printf("      Aniversario: %s                                 \n",cUsers.dataNascimento);
			printf("      Telefone: %s                                    \n",cUsers.telefone);
			printf("      E-mail: %s                                      \n",cUsers.email);
			printf("                                                      \n");
			printf("******************************************************\n");
		}
	}
	printf("\n\nPressione qualquer tecla para continuar.");
	getch();
	menu();
}

// ------------------- Utilizades -------------------
void lerParaStruct()
{
	Produtos pProduto;
	FILE *fp;
	fp = fopen("Produtos.dat", "rb");
	if(fp == NULL){
		printf("Problemas na criacao do arquivo\n");
		return ;
	}
	while(!feof(fp)){
		int lido = fread(&pProduto, sizeof(Produtos),1,fp);
		if(lido == 1){
			Produtos *aux = (Produtos*) malloc(sizeof(Produtos));
			strcpy(aux->codProduto, pProduto.codProduto);
			strcpy(aux->nomeProduto, pProduto.nomeProduto);
			aux->quantidade = pProduto.quantidade;
			aux->valorProduto = pProduto.valorProduto;
			aux->proximo = inicio;
			inicio = aux;
		}
	}
	fclose(fp);
	gotoxy(12,15); printf("Leitura concluida.");
	getch();
	administrativeSystem();
}

void gravarArquivo()
{
	Produtos *aux;
	FILE *fp;

	if((fp = fopen("Produtos.dat","ab"))==NULL)
	{
		printf("Erro na abertura do arquivo.");
		exit(1);
	}
	aux = inicio;
	while(aux!=NULL)
	{
		fwrite(&aux,sizeof(Produtos),1,fp);
		aux = aux->proximo;
	}
	fclose(fp);
	gotoxy(12,15); printf("Gravacao concluida.");
}

// ------------------- Sa√≠da -------------------

void retornar()
{
	char c;
	system("CLS");
	printf("*************************************************");
    printf("\n*               Retorno / Saida                 *");
    printf("\n*                                               *");
    printf("\n*      1 - Retornar Menu principal              *");
    printf("\n*      2 - Fechar software                      *");
    printf("\n*                                               *");
    printf("\n*************************************************");
    c = getch();
    switch(c)
    {
		case '1': MostraLogin(); break;

		case '2': sair(); break;

		default: printf("Opcao invalida.   (Press enter to continue!)"); getch(); break;
	}
}

void sair()
{
    system("CLS");
    printf("*************************************************");
    printf("\n*                                               *");
    printf("\n*     Obrigado , NewHorizon Market agradece     *");
    printf("\n*         sua presenca, volte sempre.           *");
    printf("\n*                                               *");
    printf("\n*************************************************\n");
    exit(1);
}
